<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimonSaysGame</title>
    <style>
        body {
            text-align: center;
        }

        .bodyColor {
            background-color: red;
        }

        p {
            font-weight: 900;
            color: rgb(7, 66, 82);
            margin: 5px;
        }

        h1 {
            color: rgb(255, 2, 2);
        }

        h2 {
            margin: 0;
            color: rgb(10, 127, 177);
        }

        .container {
            display: flex;
            justify-content: center;
        }

        .box {
            height: 100px;
            width: 100px;
            border: 5px solid black;
            border-radius: 20px;
            margin: 15px;
        }

        .red {
            background-color: rgb(255, 1, 1);
        }

        .yellow {
            background-color: rgb(255, 221, 0);
        }

        .green {
            background-color: rgb(0, 128, 11);
        }

        .blue {
            background-color: rgb(22, 53, 254);
        }

        .gameFlash {
            background-color: white;
        }

        .userFlash {
            background-color: rgb(0, 255, 26);
        }
    </style>
</head>
<body>
    <h1>Simon Says Game</h1>
    <h2>Press any key to start the game</h2>
    <p>*********</p>
    <br>
    <div class="container">
        <div class="frow">
            <div class="box red" type="button" id="red">1</div>
            <div class="box yellow" type="button" id="yellow">2</div>
        </div>
        <div class="srow">
            <div class="box green" type="button" id="green">3</div>
            <div class="box blue" type="button" id="blue">4</div>
        </div>
    </div>
    
    <script>
        let gameSeq = [];
        let userSeq = [];
        let scoreTracker = [];

        let btns = ["red", "yellow", "green", "blue"];

        let started = false;
        let level = 0;

        let h2 = document.querySelector("h2");

        document.addEventListener("keypress", function(){
        if(started == false) {
            console.log("game is started");
            started = true;
        
            levelUp();
        }
        });

        function gameFlash(btn){
            btn.classList.add("gameFlash");
            setTimeout(function() {
                btn.classList.remove("gameFlash");
            }, 250);
        }

        function userFlash(btn){
            btn.classList.add("userFlash");
            setTimeout(function() {
                btn.classList.remove("userFlash");
            }, 250);
        }       

        function levelUp() {
            userSeq = [];
            level++;
            h2.innerText = `Level ${level}`;
            let randIdx = Math.floor(Math.random() * 3);
            let randColor = btns[randIdx];
            let randBtn = document.querySelector(`.${randColor}`);
            gameSeq.push(randColor);

            setTimeout(function(){
                gameFlash(randBtn);
            }, 500);
        }

        function checkAns(idx){
            // console.log(`Curr level: ${level}`);
            // let idx = level - 1;

            if(gameSeq[idx] == userSeq[idx]){
            if(userSeq.length == gameSeq.length){
                setTimeout(function() {
                    levelUp();
                }, 1000);
            }
            } else {
                let p = large();
                if(p) {
                    scoreTracker.push(`${level}`);
                    h2.innerHTML = `Game Over..! &nbsp&nbsp New High Score : <b>${level}</b>`;
                    document.querySelector("p").innerText = "Press any key to start again..";
                } else {
                    h2.innerHTML = `Game Over..&nbsp Your Score was : <b>${level}</b>`;
                    document.querySelector("p").innerText = "Press any key to start again..";
                }
                document.querySelector("body").style.backgroundColor = "red";
                setTimeout(function(){
                    document.querySelector("body").style.backgroundColor = "white";
                }, 250);
                resetGame();
            }
        }

        function btnPress() {
            let btn = this;
            userFlash(btn);

            let userColor = btn.getAttribute("id");
            userSeq.push(userColor);

            checkAns(userSeq.length - 1);
        }

        let allbtns = document.querySelectorAll('.box');

        for(let btn of allbtns){
            btn.addEventListener("click", btnPress);
        }

        function resetGame() {
            started = false;
            level = 0;
            gameSeq = [];
            userSeq = [];
        }

        function large() {
            // let l = 0;
            // for(let i=0; i<scoreTracker.length; i++){
            //     if(l < scoreTracker[i]) {
            //         l = scoreTracker[i];
            //     }
            // }
            let l = 0;
            if(l < scoreTracker[scoreTracker.length - 1]) {
                l = scoreTracker[scoreTracker.length - 1];
            }
            if(`${level}` > l) {
                return true;
            } else {
                return false;
            }
        }
    </script>
</body>
</html>
